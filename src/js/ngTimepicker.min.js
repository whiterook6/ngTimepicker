angular.module("jkuri.timepicker",[]).directive("ngTimepicker",["$document",function(a){var s=function(e){var t=e.firstChild;return{top:t.offsetTop+t.offsetHeight-1,left:t.offsetLeft}},u=function(e){var t;e.showMeridian?(t=e.hour+":"+e.minutes,e.viewValue=t+" "+e.meridian,t=n(e)+":"+e.minutes):(t=e.hour+":"+e.minutes,e.viewValue=t),e.time=t},n=function(e){var t=parseInt(e.hour,10);return 12===t&&"PM"===e.meridian?12:12===t&&"AM"===e.meridian?"00":"PM"===e.meridian?t+12:0===t?12:t<10?"0"+t:t};return{restrict:"EA",scope:{time:"="},link:function(n,t,e){!function(e,t){e.initialTime=e.time||"11:00",e.step=t.step||"15";var n=t.showMeridian||!1;e.showMeridian="true"===n||!0===n,e.meridian=t.meridian||"AM",e.theme=t.theme||"",t.editable&&"false"!==t.editable?e.editable=!0:e.editable=!1}(n,e),n.opened=!1;var i,r,o=s(t[0]);n.left=o.left+"px",n.top=o.top+"px",n.showTimepicker=function(){n.opened=!0;var e=s(t[0]);n.left=e.left+"px",n.top=e.top+"px"},n.incrementHour=function(){n.showMeridian?12===parseInt(n.hour,10)?n.hour=1:11===parseInt(n.hour,10)?(n.hour=12,n.toggleMeridian()):n.hour=parseInt(n.hour,10)+1:parseInt(n.hour,10)<23?n.hour=parseInt(n.hour,10)+1:n.hour=0,parseInt(n.hour,10)<10&&(n.hour="0"+n.hour),u(n)},n.decreaseHour=function(){n.showMeridian?1===parseInt(n.hour,10)?n.hour=12:12===parseInt(n.hour,10)?(n.hour=11,n.toggleMeridian()):n.hour=parseInt(n.hour,10)-1:0===parseInt(n.hour,10)?n.hour=23:n.hour=parseInt(n.hour,10)-1,parseInt(n.hour,10)<10&&(n.hour="0"+n.hour),u(n)},n.incrementMinutes=function(){n.minutes=parseInt(n.minutes,10)+parseInt(n.step,10),59<n.minutes&&(n.minutes="00",n.incrementHour()),u(n)},n.decreaseMinutes=function(){n.minutes=parseInt(n.minutes,10)-parseInt(n.step,10),parseInt(n.minutes,10)<0&&(n.minutes=60-parseInt(n.step,10),n.decreaseHour()),0===parseInt(n.minutes,10)&&(n.minutes="00"),u(n)},n.keyDown=function(e,t){40===e.keyCode?"minutes"==t?n.decreaseMinutes():n.decreaseHour():38===e.keyCode&&("minutes"==t?n.incrementMinutes():n.incrementHour())},n.toggleMeridian=function(){n.meridian="AM"===n.meridian?"PM":"AM",u(n)},n.edit=function(){var e;!n.editable||isNaN(e.hour)||isNaN(e.minutes)||u(n)},a.on("click",function(e){t===e.target||t[0].contains(e.target)||n.$apply(function(){n.opened=!1})}),r=(i=n).initialTime.split(":"),i.hour=parseInt(r[0])%24,i.showMeridian&&(0===i.hour?(i.hour=12,i.meridian="AM"):12===i.hour?(i.hour=12,i.meridian="PM"):12<i.hour&&i.hour<22?(i.hour="0"+(i.hour-12),i.meridian="PM"):22<=i.hour?(i.hour=i.hour-12,i.meridian="PM"):(i.hour=i.hour,i.meridian="AM")),i.minutes=r[1],u(n)},template:'<input type="text" ng-focus="showTimepicker()" ng-value="viewValue" class="ng-timepicker-input" ng-readonly="true"><div class="ng-timepicker" ng-show="opened" ng-style="{\'left\': left, \'top\': top}">  <table>    <tbody>    <tr>        <td class="act noselect" ng-click="incrementHour()"><i class="fa fa-angle-up"></i></td>        <td></td>        <td class="act noselect" ng-click="incrementMinutes()"><i class="fa fa-angle-up"></i></td>        <td class="act noselect" ng-click="toggleMeridian()" ng-show="showMeridian"><i class="fa fa-angle-up"></i></td>      </tr>      <tr>        <td><input type="text" ng-model="hour" ng-readonly="!editable" ng-keydown="keyDown($event, \'hours\');" ng-change="edit()"></td>        <td>:</td>        <td><input type="text" ng-model="minutes" ng-readonly="!editable" ng-keydown="keyDown($event, \'minutes\');" ng-change="edit()"></td>        <td ng-show="showMeridian"><input type="text" ng-model="meridian" ng-readonly="true"></td>      </tr>      <tr>        <td class="act noselect" ng-click="decreaseHour()"><i class="fa fa-angle-down"></i></td>        <td></td>        <td class="act noselect" ng-click="decreaseMinutes()"><i class="fa fa-angle-down"></i></td>        <td class="act noselect" ng-click="toggleMeridian()" ng-show="showMeridian"><i class="fa fa-angle-down"></i></td>      </tr>  </table></div>'}}]);